**************************************************************

アフィリエイトＡＳＰシステム　設置マニュアル

**************************************************************

弊社、アフィリエイトＡＳＰシステムをご購入頂き有難う御座います。

システムの設置方法は下記を参照下さい。

■インストール手順

-------------------------------------------------------------

１．「aflasp_***.zip」を解凍ソフトで解凍を行って頂き
「./custom/extends/sqlConf.php」ファイルの記述内容を変更します。

※主にDB種別、DB名、接続ID、PASSを設定します。
こちらの設定項目は、各サーバーの設定に従って下さい。

SQLは下記の２つのデータベースに対応しております。
どれか１つを選択し記述して下さい。

$SQL_MASTER = 'SQLiteDatabase';		//SQLite
$SQL_MASTER = 'MySQLDatabase';		//MySQL（通常はこちら）

※SQLiteを使用される場合は、書き換える必要は御座いません。
但し、SQLiteの動作は非常に遅くなりますので予めご了承下さい。
※文字コードはSJISで設定してください。

-------------------------------------------------------------

２．「１」で解凍／設定を行ったファイルをＦＴＰクライアントツールを利用し
ご利用のサーバーにアップロードします。

-------------------------------------------------------------

３．ＦＴＰ上から下記のファイルのパーミッションを変更します。

./file/			777
./file/*		777
./logs/			777
./logs/*.log		777
./tdb/			777
./tdb/*.csv		777
./tdb/module/		777
./tdb/module/*.csv	777
./report/		777

-------------------------------------------------------------

４．ブラウザより下記のページにアクセスを行い
ページ最下部にある「完全インポート」をクリックして頂くことで
初期化は完了します。

http://設置先/tool.php

※初期設定パスワードは「admin」となっております。

※サーバー状況により非常に時間が掛かる場合があります。

設置先ＴＯＰページ（index.php）にアクセスして頂きページが
正常に表示されていればインストールが完了しております。

※「tool.php」はご利用後、必ず削除して頂くようお願い致します。
※SQL導入後、./tdb/以下のデータ等は削除して頂くかパスワード設定を
管理者様の責任で行って頂くようお願い致します。

５．w3cディレクトリのアップロード

広告認証形式にcookieを使用する場合は以下の設定が必要となります。
Internet Explorer等のブラウザでは、p3p プライバシーポリシーの設定が正しくない場合、
クロスドメインでcookieを使用することができません。

「full.xml」と「p3p.xml」をテキストエディタ等で開いていただき、
「　http://www.example.com/　」を
アフィリエイトシステムを設置した環境に合わせて書き換えて下さい。

「full.xml」の記述内容、
「　example@example.com　」も合わせて書き換えをお願いします。

「w3c」ディレクトリをドメイン直下に設置してください。
パーミッション等の設定は不要です。

例)　http://www.websquare.co.jp/affiliate/　に設置した場合

アップロード先
「　http://www.websquare.co.jp/w3c/　」

URLの書き換え
「　http://www.example.com/　」を
「　http://www.websquare.co.jp/　」に書き換え

設定が正しく行えているかを確認するには、W3Cが提供しているP3P Validator等をご利用ください。
http://www.w3.org/P3P/validator.html

-------------------------------------------------------------

■設定手順

１．管理者ログインページにアクセスを行いログインをします。

※デフォルト管理者ＩＤ／ＰＡＳＳ
ＩＤ		admin@example.com
ＰＡＳＳ	admin

２．サイドメニューからそれぞれの設定を行います。

※設定項目は各種画面の項目名をご覧下さい。

-------------------------------------------------------------

■トラッキングコード仕様

以下のようなタグを、料金を発生させたいページ（主に注文・申込み完了ページ）のソースに書き込んでください。
注文・申込みが完了した完了ページが表示される際に、タグを読み込む事により、報酬がカウントされます。

◆例１	固定金額の報酬を発生させる場合

<img src="システム設置先/add.php?check=タグ認証用パス" width="1" height="1">

◆例２	歩合金額の報酬を発生させる場合

★EC-CUBE(2.4系)に設置する場合
<img src="システム設置先/add.php?check=タグ認証用パス&eccube=<!--{$tpl_aff_option}-->" width="1" height="1">

★その他のシステムに設置する場合
<img src="システム設置先/add.php?check=タグ認証用パス&sales=売上金額" width="1" height="1">

※金額とは商品の購入額をそのまま渡します。その金額から還元率をかけて還元額を計算します。
※EC-CUBE 2.4系への設置の場合は、Smarty変数の$tpl_aff_optionを使用することで特別なカスタマイズなしに連携することが可能です。
　2.11系以降、標準では歩合報酬の設定はできません。

◆その他の属性について

上記トラッキングコードで最低限の認証は行えますが、
より正確トラッキングを行う場合は下記のパラメータを追加して下さい。

◇from=付属情報１

アフィリエイトシステム側に任意の文字列を渡すことができます。
※半角英数字のみとなります。

◇from_sub=付属情報２

アフィリエイトシステム側に任意の文字列を渡すことができます。
※半角英数字のみとなります。

◇guid=on　※固定値

固体識別番号（iモードID）を利用し認証を行います。
※送信されない場合には、UAを利用して認証を行います。

◇aid=アクセスID

広告ページに飛ぶ際に付与される「aid」をシステム内で引き回して頂き、
トラッキング時に返すことで正確な認証が可能となります。

※aidはアクセスログ保存時に生成する形となりますので
連続したアクセス等の不正なアクセス時には付与されません。
取り扱いにはこの点にご注意下さい。

◇adwares=個別の広告ID

広告別にトラッキングコードを分ける際に利用します。
別トラッキングコードからの誤認証を防ぐことができます。

-------------------------------------------------------------

■継続報酬（ライフタイムコミッション機能）利用方法について

広告登録時に、継続報酬利用を選択した上で
「add.php」へのトラッキング時に通常通り、初回報酬を発生させます。
この時にget引数にて「uid（組み込み先のユニークＩＤ）」を渡して頂きます。

次回以降の報酬発生には、「continue.php」へ
「check」「uid」を渡して頂くことで継続報酬が発生します。
※歩合の場合は、「sales」も渡して頂く必要が御座います。

※こちらの機能は上級者向けの設定となります。
継続的に報酬を発生させる場合、連携先のカート等のシステムから
任意のタイミングで通知をする必要があります。

-------------------------------------------------------------

■よくある質問（Ｑ＆Ａ）

---

【Ｑ１】
自動的に送信されるメールテンプレートの編集方法を教えてください。

【Ａ１】
メールテンプレートファイルは下記に格納されております。
./template/pc/mail_contents/		ＰＣ用
./template/mobile/mail_contents/	携帯用

---

【Ｑ２】
携帯の認証はどのように行っていますか？aidは必要ですか？

【Ａ２】

DoCoMoはiモードID、Au、SoftBankは個体識別番号を利用し
認証を行なっておりますので、「aid（※上記記載）」の
引き回しは必須では御座いません。

但し、稀に上記識別番号の送信設定をＯＦＦにされている端末があるようですので
その場合には機種名（UA）にて認証を行ないます。
機種名にて認証を行なった際に、同一機種名を持つ別のユーザーが
ほぼ同時に購入処理を行った際に成果が正常に上がらない可能性が御座います。

上記の症状が続く場合には、aidの引き回しをジャンプ先サイトで行って頂く必要が御座います。

---

【Ｑ３】
子・孫のティアを無効にしたいのですが可能ですか？

【Ａ３】
「サイト設定の変更」より「子（孫）から受け取る割合」を
「0％」に設定することで無効となります。

-------------------------------------------------------------

■SSLの導入について

SSLを導入して頂く場合、下記の設定ファイルを変更してください。
./custom/extentds/sslConf.php

	//SSLへのリダイレクトを有効に
	$CONFIG_SSL_ENABLE = true;

※初期設定はOFF(false)になっています。

-------------------------------------------------------------
---　　 下記は、エラーが出た場合の対処方法となります. 　　---
-------------------------------------------------------------

■事象１

Parse error: syntax error, unexpected T_OBJECT_OPERATOR in
./include/ccProc.php on line 592

上記のようなエラーが出た場合、
お使いのＰＨＰバージョンが５ではない可能性があります。
ＰＨＰ５が利用可能なサーバーに移転をお願い致します。

-------------------------------------------------------------

当システムは独自のライセンス管理をしております。
不正な利用が発見された場合には、ライセンス費用をご請求する場合が御座います。
ご不明な点が御座いましたらお気軽にお問い合わせ下さい。

■━━━━━━━━━━━━━━━━━━━━━━━
株式会社ウェブスクウェア
本社：大阪府門真市新橋町17-8ライズビル4F
開発本部：滋賀県草津市西渋川1-1-18イーカムビル4F
TEL 077-500-0226　/　FAX 077-500-0823
http://www.websquare.co.jp/

▼WEBパッケージ：http://www.websquare.co.jp/package.html
▼パートナー制度：http://www.wspartner.biz/
▼製品技術資料/マニュアル：http://wsmanual.net/

※営業時間：平日10:00〜18:00  土日祝は休日となります。
━━━━━━━━━━━━━━━━━━━━━━━■
